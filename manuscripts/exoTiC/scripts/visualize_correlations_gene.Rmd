---
title: "Microbe and gene correlations"
author: "Rebecca Hoyd"
date: "4/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(tidygraph)
library(ggraph)
```

# Load data

```{r}
edges.raw <- readRDS("/fs/ess/PAS1695/projects/exotic/data/network_TCC-corr-in.RDS")
```

# Some quick queries

```{r}
hub.m <- edges.raw %>%
  group_by(microbe) %>%
  tally() %>%
  arrange(desc(n))

hub.g <- edges.raw %>%
  group_by(Gene) %>%
  tally() %>%
  arrange(desc(n))

head(hub.m)
```

# Format for network

```{r try basic tidygraph}
bad.genes <- hub.g %>%
  filter(n > 6000)


edges.tidygraph <- edges.raw %>%
  anti_join(bad.genes) %>%
  arrange(p.value) %>%
  mutate(from = microbe,
         to = Gene,
         r = row_number()) %>%
  filter(r <= 100) %>%
  select(from, to) %>%
  as_tbl_graph()
```

```{r}
edges.tidygraph %>% 
    ggraph() + 
    geom_edge_link() + 
    geom_node_point() +
    # geom_node_text(aes(label = name), colour = 'white', vjust = 0.4) + 
    ggtitle('test') + 
    theme_graph()
```
# Prepare for pathways
