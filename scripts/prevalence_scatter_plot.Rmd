---
title: "Prevalence Scatter Plot"
author: "Mitchell Muniak"
date: "5/13/2021"
output: html_document
---

```{r setup, include=FALSE}
library(readxl)
library(ggplot2)
library(tidyverse)
library(tidyr)
library(lubridate)
```

# Load Data

+ Here, I am loading in each excel sheet. Each sheet contains prevalence data from an individual source.
+ Our data and Y. Yang's data are especially interesting because they were both processed based on raw data entries. Because of this, they are much larger and more comprehensive than the other files. In comparison, the other excel sheets were created based on what was shown in the graphs and figures of publication. Very little supplementary information was available for these publications.
```{r, message=FALSE}
# Load our prevalence data
prev_spak <- read_csv("../data/prevalence_fulltaxa.csv")
```
```{r, message=FALSE}
# Load in data frames from my literature search
prev_kostic <- read_csv("../data/Aleksandar_D._Kostic_prev.csv")
prev_j_yang <- read_csv("../data/Jinho_Yang_prev.csv")
prev_castellarin <- read_csv("../data/Mauro_Castellarin_prev.csv")
prev_long <- read_csv("../data/Shuping_Long_prev.csv")
prev_eisele <- read_csv("../data/Yannick_Eisele_prev.csv")

```
```{r, message=FALSE}
# Load in Y. Yang data
prev_y_yang <- read_csv("../data/y_yang_prev.csv")
```

# Create Filter

```{r, message=FALSE}
# Join together all the data frames
prev_join <- prev_spak %>%
  full_join(prev_y_yang) %>%
  full_join(prev_kostic) %>%
  full_join(prev_j_yang) %>%
  full_join(prev_castellarin) %>%
  full_join(prev_long) %>%
  full_join(prev_eisele)
```

```{r}  
# We want to tally how many times each taxon appears, which will represent how many studies the taxon appeared. We are doing this because graphing a taxon that only appears in one study is not informative.
taxon_filter <- as.list(tally(group_by(prev_join, Taxon)) %>%
                           # Filter for appearances in at least 3 studies
                           filter(n > 2) %>%
                           select(-n))
```

# Scatter plot

+ We want to plot as x = prevalence of taxon based on our data and  y = prevalence of taxon based on literature
+ Therefore, for this data frame, we will want a column for our prevalence, and a column for literature prevalence
```{r, message=FALSE}
# Here, I join the literature data frames
prev_scatter_lit <- prev_y_yang %>%
  full_join(prev_kostic) %>%
  full_join(prev_j_yang) %>%
  full_join(prev_castellarin) %>%
  full_join(prev_long) %>%
  full_join(prev_eisele) %>%
  # I rename the prevalence column to identify it as the prevalence from our references
  rename(ref.prevalence = Prevalence)  %>%
  # We reuse the filter from above to allow us to join this new data frame
  filter(Taxon %in% taxon_filter[["Taxon"]])
```
```{r, message=FALSE}
# We join our data to the literature data
prev_scatter <- prev_spak %>%
  # Our data has its prevalence column renamed
  rename(our.prevalence = Prevalence) %>%
  # No need to keep reference identifier for our data. In the final data frame, our data prevalence will have its own column 
  select(-Ref, -Reference) %>%
  # Joined
  right_join(prev_scatter_lit) %>%
  filter(!is.na(our.prevalence))
```

```{r}
# Combined Scatter Plot
# Here we plot all taxon prevalence points from the prev_scatter data frame.
prev_scatter %>%
  # set axes
  ggplot(aes(x = our.prevalence, y = ref.prevalence)) +
  # Color based on reference (with respect to the reference y-axis)
  geom_point(aes(color = Ref)) + 
  ggtitle("Taxon Prevalence Reference vs Our Data") + 
  theme_bw() +
  theme(legend.key.size = unit(0.01, 'mm'),
        legend.text = element_text(size=8))
```
```{r}
# Individual Scatter Plots
# Create scatter plot for each reference
ref_scatter <-unique(prev_scatter$Reference)
for(ref.type in ref_scatter){
  # Print outputs
  print(prev_scatter %>%
          filter(Reference == ref.type) %>%
          # Set each axis
          ggplot(aes(x = our.prevalence, y = ref.prevalence)) +
          # Color data points based on response
          geom_point() +
          facet_wrap(vars(Reference), scales = "free_y"))}
```