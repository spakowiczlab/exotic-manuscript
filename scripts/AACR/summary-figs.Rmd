---
title: "Summary figures"
author: "Rebecca Hoyd"
agg_exo.rae: "February 6, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(tidyr)
library(ggplot2)
library(forcats)
```

# Load data

```{r}
exo.ra <- read.table("../../data/agg_exo-ra.txt", header = TRUE, stringsAsFactors = F)
```


# Microbe stacked bar

```{r}
# are there any NAs in the df
any(is.na(exo.ra))

# Fill any NAs with a 0
exo.ra[is.na(exo.ra)] <- 0


exo.ra.l <- exo.ra %>%
  gather(-sample, -cancer, key = "micro", value = "percent")

get.mic.ord <- exo.ra.l %>%
  group_by(micro) %>%
  summarise(mean.pr = mean(percent)) %>%
  arrange(mean.pr)

exo.ra.l %>%
  ggplot(aes(x = sample,
             y = percent, 
             # fill = fct_relevel(micro, get.mic.ord$micro)
             fill = micro
             ))+
  facet_wrap(vars(cancer), scales = "free_x", nrow = 1) +
  geom_bar(position="fill", stat = "identity") +
  labs(x = "", y = "") +
  theme_bw() +
  theme(legend.position = "none",
        axis.text.x = element_blank(), axis.ticks.x = element_blank(), 
        panel.grid.major = element_blank()) +
  ggsave("../../figures/AACR/stacked-bar_microbes.png", height = 10, width = 10)

```